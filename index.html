<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Wunder Paper Auto Trader</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 10px;
    }
    .version {
      text-align: center;
      font-size: 0.8rem;
      color: #aaa;
    }
    .panel {
      background: #1e1e1e;
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    }
    button {
      padding: 8px 14px;
      margin: 4px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .buy { background: #006400; color: #fff; }
    .sell { background: #8b0000; color: #fff; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table th, table td {
      border: 1px solid #333;
      padding: 6px;
      text-align: center;
    }
    .green { color: #00ff7f; }
    .red { color: #ff6347; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ“ˆ Wunder Paper Auto Trader</h1>
    <div class="version">Build: v2.1 (static / no backend)</div>

    <div class="panel">
      <button id="toggleAuto">Start Auto</button>
      <button id="refresh">Refresh</button>
      <button id="reset">Reset Data</button>
      <div id="status">Auto: OFF</div>
      <div id="pnl">Total Realized PnL: +0.00 | Equity (R+U): +0.00</div>
    </div>

    <div class="panel">
      <label>Symbols (comma, USDT):</label>
      <input id="symbols" type="text" value="BTCUSDT,XRPUSDT,DOGEUSDT,PEPEUSDT" style="width:100%" />
      <label>Base USDT:</label>
      <input id="base" type="number" value="10" />
      <label>Strength:</label>
      <input id="strength" type="number" value="1" step="0.1" />
      <label>TP %:</label>
      <input id="tp" type="number" value="1" step="0.1" />
      <label>SL %:</label>
      <input id="sl" type="number" value="2" step="0.1" />
    </div>

    <div class="panel">
      <table id="positions">
        <thead>
          <tr>
            <th>Symbol</th>
            <th>Price</th>
            <th>Qty</th>
            <th>Avg Entry</th>
            <th>UPnL</th>
            <th>TP</th>
            <th>SL</th>
            <th>Signal</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // === STATE ===
    let autoTrading = false;
    let positions = JSON.parse(localStorage.getItem("positions") || "{}");
    let realizedPnL = parseFloat(localStorage.getItem("realizedPnL") || "0");

    const statusEl = document.getElementById("status");
    const pnlEl = document.getElementById("pnl");
    const positionsEl = document.getElementById("positions").querySelector("tbody");
    const toggleBtn = document.getElementById("toggleAuto");

    function log(msg) { console.log("[BOT]", msg); }

    // === TOGGLE AUTO ===
    toggleBtn.addEventListener("click", () => {
      autoTrading = !autoTrading;
      statusEl.textContent = "Auto: " + (autoTrading ? "ON" : "OFF");
      toggleBtn.textContent = autoTrading ? "Stop Auto" : "Start Auto";
      log("Auto toggled -> " + autoTrading);
    });

    // === REFRESH ===
    document.getElementById("refresh").addEventListener("click", () => {
      updateTable();
      log("Manual refresh done");
    });

    // === RESET ===
    document.getElementById("reset").addEventListener("click", () => {
      positions = {};
      realizedPnL = 0;
      localStorage.removeItem("positions");
      localStorage.removeItem("realizedPnL");
      updateTable();
      log("Data reset");
    });

    // === UPDATE TABLE ===
    function updateTable() {
      positionsEl.innerHTML = "";
      let equity = realizedPnL;
      Object.keys(positions).forEach(sym => {
        let p = positions[sym];
        let row = `<tr>
          <td>${sym}</td>
          <td>${p.price?.toFixed(6) || 0}</td>
          <td>${p.qty?.toFixed(6) || 0}</td>
          <td>${p.entry?.toFixed(6) || 0}</td>
          <td class="${p.uPnL>=0?'green':'red'}">${p.uPnL?.toFixed(2) || 0}</td>
          <td>${p.tp || '-'}</td>
          <td>${p.sl || '-'}</td>
          <td>${p.signal || '-'}</td>
        </tr>`;
        positionsEl.innerHTML += row;
        equity += (p.uPnL||0);
      });
      pnlEl.textContent = `Total Realized PnL: ${realizedPnL.toFixed(2)} | Equity (R+U): ${equity.toFixed(2)}`;
    }

    // === SIMULATE AUTO ===
    setInterval(() => {
      if (!autoTrading) return;
      // contoh dummy update posisi (nanti ganti logika sinyal real)
      ["BTCUSDT","XRPUSDT","DOGEUSDT","PEPEUSDT"].forEach(sym=>{
        let price = (Math.random()*100 + 1).toFixed(4);
        positions[sym] = {
          price: parseFloat(price),
          qty: Math.random(),
          entry: parseFloat(price),
          uPnL: (Math.random()*2-1)*10,
          tp: "1%",
          sl: "2%",
          signal: Math.random()>0.5?"BUY":"SELL"
        };
      });
      localStorage.setItem("positions", JSON.stringify(positions));
      updateTable();
      log("Auto tick updated");
    }, 5000);

    updateTable();
  </script>
</body>
</html>
